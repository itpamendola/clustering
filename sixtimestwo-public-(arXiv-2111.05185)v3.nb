(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[         0,          0]
NotebookDataLength[    105441,       2450]
NotebookOptionsPosition[    103417,       2404]
NotebookOutlinePosition[    103851,       2423]
CellTagsIndexPosition[    103808,       2420]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["\<\
Clustering of Standard Candles. 6x2 method. 

 \
\>", "Title",
 CellChangeTimes->{{3.753982763376039*^9, 3.753982785950391*^9}, {
   3.7797781525144453`*^9, 3.779778155104732*^9}, {3.779883435698763*^9, 
   3.779883437913247*^9}, {3.780469776306284*^9, 3.780469783220976*^9}, {
   3.7834041964443417`*^9, 3.783404202312543*^9}, {3.8304887173790283`*^9, 
   3.830488724437229*^9}, {3.835545001388667*^9, 3.835545011483615*^9}, {
   3.843193841369033*^9, 3.8431938641294823`*^9}, {3.843537185461478*^9, 
   3.843537188998011*^9}, {3.843889005650239*^9, 3.8438890082724247`*^9}, 
   3.84449761583223*^9, {3.845088191359421*^9, 3.8450881958583727`*^9}, {
   3.845215279319659*^9, 3.845215284261301*^9}, 3.8455515608650837`*^9, 
   3.846126476587151*^9},ExpressionUUID->"be7de5ef-fc06-4fed-8496-\
03868675c388"],

Cell["\<\
L. Amendola & M. Quartin 2019, 2021

This notebook evaluates the relative errors for H using the 6x2 Clustering of \
Standards method. It reads the external file CAMB0.txt (also in this \
repository) produced with the CAMB code. Running the entire notebook requires \
about one hour on a desktop computer. Please refer to arXiv:1912:10255 and \
arXiv:2111.05185 for the details. If you use this notebook please cite that \
paper. 

\
\>", "Text",
 CellChangeTimes->{{3.75398279129556*^9, 3.7539827975695953`*^9}, {
  3.783404209042066*^9, 3.783404264704615*^9}, {3.7834088296637173`*^9, 
  3.783408892743311*^9}, {3.783409236192415*^9, 3.7834093242009497`*^9}, {
  3.783409424305244*^9, 3.783409449169313*^9}, {3.783415426507889*^9, 
  3.7834154467542057`*^9}, {3.7852269367679043`*^9, 3.7852269370463953`*^9}, {
  3.787922477940608*^9, 3.787922480390863*^9}, {3.800987503331622*^9, 
  3.800987520310482*^9}, {3.831462394583008*^9, 3.831462403400135*^9}, {
  3.8417259630863247`*^9, 3.84172596406995*^9}, {3.844497623218916*^9, 
  3.844497667577457*^9}, {3.844497895923266*^9, 3.844497901697921*^9}, {
  3.844515262626482*^9, 3.844515269959178*^9}, {3.8459097978802633`*^9, 
  3.8459098059093733`*^9}},ExpressionUUID->"0bdb1a45-2ab7-43bc-8bb3-\
c6bf88f83168"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SetDirectory", "[", 
    RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.759131816390334*^9, 3.759131823392077*^9}, 
   3.7834339212900877`*^9, 3.8417259539564877`*^9},
 CellLabel->"In[1]:=",ExpressionUUID->"d33f6e9f-b116-40e7-af4d-d13a39b394ee"],

Cell[CellGroupData[{

Cell["Building the Fisher matrix ", "Section",
 CellChangeTimes->{{3.753842456013628*^9, 3.753842468350934*^9}, {
   3.753842892579604*^9, 3.7538428937619333`*^9}, {3.753845702382867*^9, 
   3.753845704711443*^9}, {3.75388019088731*^9, 3.7538801920136833`*^9}, {
   3.7538997392290297`*^9, 3.753899741601087*^9}, {3.753961025018955*^9, 
   3.7539610346686087`*^9}, {3.754632396925252*^9, 3.754632398556015*^9}, {
   3.7547231582197866`*^9, 3.754723160435848*^9}, 3.7798834252517*^9, {
   3.783408414565756*^9, 3.783408416565634*^9}, {3.7834091896339912`*^9, 
   3.783409199344324*^9}},ExpressionUUID->"e7b35478-e180-4bd6-ae4e-\
7e4bfe44083c"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"build", " ", "the", " ", "Fisher", " ", "matrix"}], " ", "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ClearAll", ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"eta", "=", 
      RowBox[{"eta", "/", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"1", "+", 
         RowBox[{"ok", "*", 
          RowBox[{
           RowBox[{
            RowBox[{"dlum", "[", "z", "]"}], "^", "2"}], "/", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1", "+", "z"}], ")"}], "^", "2"}]}]}]}], "]"}]}]}], 
     ";"}], " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"facb", "=", 
     RowBox[{"dd", "*", 
      RowBox[{"(", 
       RowBox[{"1", "+", 
        RowBox[{"beta", "*", 
         RowBox[{"mu", "^", "2"}], "*", 
         RowBox[{
          RowBox[{"etan", "^", "2"}], "/", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"mu", "^", "2"}], "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"etan", "^", "2"}], "-", "1"}], ")"}]}], "+", "1"}], 
           ")"}]}]}]}], ")"}]}]}], ";", 
    RowBox[{"faca", "=", 
     RowBox[{"dv", "*", "hfid", "*", "beta", "*", "mu", "*", "etan", "*", 
      RowBox[{
       RowBox[{
        RowBox[{"eta", "/", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"mu", "^", "2"}], "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"etan", "^", "2"}], "-", "1"}], ")"}]}], "+", "1"}], 
          ")"}]}], "/", "k"}], "/", 
       RowBox[{"(", 
        RowBox[{"1", "+", "z"}], ")"}]}]}]}], ";"}], " ", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"facbg", "=", 
     RowBox[{"ddg", "*", 
      RowBox[{"(", 
       RowBox[{"1", "+", 
        RowBox[{"betag", "*", 
         RowBox[{"mu", "^", "2"}], "*", 
         RowBox[{
          RowBox[{"etan", "^", "2"}], "/", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"mu", "^", "2"}], "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"etan", "^", "2"}], "-", "1"}], ")"}]}], "+", "1"}], 
           ")"}]}]}]}], ")"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"shot", " ", "noise", " ", "terms"}], "  ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nd", "=", 
     RowBox[{"1", "+", 
      RowBox[{
       RowBox[{"1", "/", 
        RowBox[{"facb", "^", "2"}]}], "/", 
       RowBox[{"p", "[", "etan", "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nv", "=", 
     RowBox[{"1", "+", 
      RowBox[{"1", "*", 
       RowBox[{
        RowBox[{"sv2", "/", 
         RowBox[{"faca", "^", "2"}]}], "/", 
        RowBox[{"p", "[", "etan", "]"}]}]}]}]}], ";"}], " ", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ndg", "=", 
     RowBox[{"1", "+", 
      RowBox[{"1", "/", 
       RowBox[{"(", 
        RowBox[{"r", "*", 
         RowBox[{"Rb", "^", "2"}], "*", 
         RowBox[{"facbg", "^", "2"}], "*", 
         RowBox[{"p", "[", "etan", "]"}]}], ")"}]}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ndfv", "=", 
     RowBox[{"1", "+", 
      RowBox[{"frac", "/", 
       RowBox[{"(", 
        RowBox[{"r", "*", "Rb", "*", "facb", "*", "facbg", "*", 
         RowBox[{"p", "[", "etan", "]"}]}], ")"}]}]}]}], ";"}], "  ", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Rb", "=", 
     RowBox[{"beta", "/", "betag"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"method", "=", "6"}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Choose", " ", "the", " ", 
       RowBox[{"method", ":", " ", "1"}]}], "=", 
      RowBox[{"1", "x2"}]}], ";", " ", 
     RowBox[{"3", "=", 
      RowBox[{"3", "x2"}]}], ";", " ", 
     RowBox[{"6", "=", 
      RowBox[{"6", "x2"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
      "Omega_k", " ", "is", " ", "added", " ", "to", " ", "the", " ", 
       "parameters", " ", "but", " ", "not", " ", "used"}], ";", " ", 
      RowBox[{"because", " ", "of", " ", "this"}]}], ",", " ", 
     RowBox[{
     "Mathematica", " ", "can", " ", "produce", " ", "a", " ", "warning", " ",
       "because", " ", "some", " ", "integrands", " ", "are", " ", "zero"}], 
     ",", " ", 
     RowBox[{
     "with", " ", "no", " ", "impact", " ", "on", " ", "the", " ", 
      "results"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Which", "[", 
     RowBox[{
      RowBox[{"method", "\[Equal]", "6"}], ",", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"6", "x2", " ", "covariance", " ", "matrix"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"check", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"c", "=", 
         RowBox[{"Simplify", "[", 
          RowBox[{
           RowBox[{"p", "[", "etan", "]"}], "*", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"facb", "^", "2"}], "*", "nd"}], ",", 
               RowBox[{"check", "*", "faca", "*", "facb"}], ",", 
               RowBox[{
                RowBox[{"Sqrt", "[", "r", "]"}], "*", "Rb", "*", "facb", "*", 
                "facbg", "*", "ndfv"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"check", "*", "faca", "*", "facb"}], ",", 
               RowBox[{
                RowBox[{"faca", "^", "2"}], "*", "nv"}], ",", 
               RowBox[{
                RowBox[{"Sqrt", "[", "r", "]"}], "*", "Rb", "*", "faca", "*", 
                "facbg"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"Sqrt", "[", "r", "]"}], "*", "Rb", "*", "facb", "*", 
                "facbg", "*", "ndfv"}], ",", 
               RowBox[{
                RowBox[{"Sqrt", "[", "r", "]"}], "*", "Rb", "*", "faca", "*", 
                "facbg"}], ",", 
               RowBox[{"r", "*", 
                RowBox[{"Rb", "^", "2"}], "*", 
                RowBox[{"facbg", "^", "2"}], "*", "ndg"}]}], "}"}]}], "}"}]}],
           "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"parameters", ";", " ", 
           RowBox[{
           "we", " ", "actually", " ", "use", " ", "the", " ", "log", " ", 
            "of", " ", "these", " ", "in", " ", "the", " ", "matrix"}]}], ",",
           " ", 
          RowBox[{"except", " ", "for", " ", 
           RowBox[{"Omega_k", " ", "!"}]}]}], "*)"}], "\n", 
        RowBox[{"ppar", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"p", "[", "etan", "]"}], ",", "beta", ",", "betag", ",", 
           "eta", ",", "sigd", ",", "sigv", ",", "sigdg", ",", "ok"}], 
          "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ppar2", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"p", "[", "etan", "]"}], ",", "beta", ",", "betag", ",", 
           "eta", ",", "sigd", ",", "sigv", ",", "sigdg", ",", "1"}], "}"}]}],
         ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"needed", " ", "to", " ", "take", " ", "linear", " ", 
          RowBox[{"(", 
           RowBox[{"not", " ", "\"\<log\>\""}], ")"}], " ", "derivative", " ",
           "wrt", " ", "ok"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"npar", "=", 
         RowBox[{"Length", "[", "ppar", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "number", " ", "of", " ", "params", " ", "that", " ", "depend", " ",
            "also", " ", "on", " ", "k"}], " ", ",", "  ", 
          RowBox[{
          "those", " ", "that", " ", "deend", " ", "only", " ", "on", " ", 
           "z"}], ",", " ", 
          RowBox[{"and", " ", "those", " ", "independent"}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"nk", "=", "3"}], ";", "\[IndentingNewLine]", 
        RowBox[{"nz", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"nzorig", "=", "nz"}], ";", "\[IndentingNewLine]", 
        RowBox[{"n0", "=", "4"}], ";", "\[IndentingNewLine]", 
        RowBox[{"n0orig", "=", "n0"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"method", "\[Equal]", "1"}], ",", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"1", "x2", " ", "covariance", " ", 
         RowBox[{"matrix", ":", " ", 
          RowBox[{"version", " ", "1", "x2", " ", "g"}]}]}], "  ", "*)"}], 
       "\n", 
       RowBox[{
        RowBox[{"check", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"c", "=", 
         RowBox[{"Simplify", "[", 
          RowBox[{
           RowBox[{"p", "[", "etan", "]"}], "*", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"r", "*", 
              RowBox[{"Rb", "^", "2"}], "*", 
              RowBox[{"facbg", "^", "2"}], "*", "ndg"}], "}"}], "}"}]}], 
          "]"}]}], ";", "\n", 
        RowBox[{"ppar", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"p", "[", "etan", "]"}], ",", "betag", ",", "eta", ",", 
           "sigdg", ",", "ok"}], "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ppar2", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"p", "[", "etan", "]"}], ",", "betag", ",", "eta", ",", 
           "sigdg", ",", "1"}], "}"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"needed", " ", "to", " ", "take", " ", "linear", " ", 
          RowBox[{"(", 
           RowBox[{"not", " ", "\"\<log\>\""}], ")"}], " ", "derivative", " ",
           "wrt", " ", "ok"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"npar", "=", 
         RowBox[{"Length", "[", "ppar", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "number", " ", "of", " ", "params", " ", "that", " ", "depend", " ",
            "also", " ", "on", " ", "k"}], " ", ",", "  ", 
          RowBox[{
          "those", " ", "that", " ", "depend", " ", "only", " ", "on", " ", 
           "z"}], ",", " ", 
          RowBox[{"and", " ", "those", " ", "independent"}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"nk", "=", "2"}], ";", "\[IndentingNewLine]", 
        RowBox[{"nz", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"nzorig", "=", "nz"}], ";", "\[IndentingNewLine]", 
        RowBox[{"n0", "=", "2"}], ";", "\[IndentingNewLine]", 
        RowBox[{"n0orig", "=", "n0"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"method", "==", "3"}], ",", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"3", "x2", " ", "covariance", " ", 
         RowBox[{"matrix", ":", " ", 
          RowBox[{
           RowBox[{"version", " ", "3", "x2", " ", "g"}], "-", "s"}]}]}], " ",
         "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"check", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"c", "=", 
         RowBox[{"Simplify", "[", 
          RowBox[{
           RowBox[{"p", "[", "etan", "]"}], "*", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"faca", "^", "2"}], "*", "nv"}], ",", 
               RowBox[{
                RowBox[{"Sqrt", "[", "r", "]"}], "*", "Rb", "*", "faca", "*", 
                "facbg"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"Sqrt", "[", "r", "]"}], "*", "Rb", "*", "faca", "*", 
                "facbg"}], ",", 
               RowBox[{"r", "*", 
                RowBox[{"Rb", "^", "2"}], "*", 
                RowBox[{"facbg", "^", "2"}], "*", "ndg"}]}], "}"}]}], "}"}]}],
           "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"parameters", ";", " ", 
           RowBox[{
           "we", " ", "actually", " ", "use", " ", "the", " ", "log", " ", 
            "of", " ", "these", " ", "in", " ", "the", " ", "matrix"}]}], ",",
           " ", 
          RowBox[{"except", " ", "for", " ", 
           RowBox[{"ok", " ", "!"}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
           "beta_s", " ", "is", " ", "degenerate", " ", "with", " ", "P", " ",
             "in", " ", "the", " ", "3", "x2", " ", "g"}], "-", 
           RowBox[{"s", " ", "case"}]}], ";", " ", 
          RowBox[{
           RowBox[{"not", " ", "in", " ", "the", " ", "3", "x2", " ", "s"}], 
           "-", 
           RowBox[{"s", " ", "case"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"ppar", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"p", "[", "etan", "]"}], ",", "betag", ",", "eta", ",", 
           "sigv", ",", "sigdg", ",", "ok"}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ppar2", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"p", "[", "etan", "]"}], ",", "betag", ",", "eta", ",", 
           "sigv", ",", "sigdg", ",", "1"}], "}"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"needed", " ", "to", " ", "take", " ", "linear", " ", 
          RowBox[{"(", 
           RowBox[{"not", " ", "\"\<log\>\""}], ")"}], " ", "derivative", " ",
           "wrt", " ", "ok"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"npar", "=", 
         RowBox[{"Length", "[", "ppar", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "number", " ", "of", " ", "params", " ", "that", " ", "depend", " ",
            "also", " ", "on", " ", "k"}], " ", ",", "  ", 
          RowBox[{
          "those", " ", "that", " ", "deend", " ", "only", " ", "on", " ", 
           "z"}], ",", " ", 
          RowBox[{"and", " ", "those", " ", "independent"}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"nk", "=", "2"}], ";", "\[IndentingNewLine]", 
        RowBox[{"nz", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"nzorig", "=", "nz"}], ";", "\[IndentingNewLine]", 
        RowBox[{"n0", "=", "3"}], ";", "\[IndentingNewLine]", 
        RowBox[{"n0orig", "=", "n0"}]}], "}"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", "  ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"invc", "=", 
     RowBox[{"Simplify", "[", 
      RowBox[{"Inverse", "[", "c", "]"}], "]"}]}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"n", "=", 
     RowBox[{"Length", "[", "c", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"smoothing", " ", "factors"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dv", "=", 
     RowBox[{"Exp", "[", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"(", 
         RowBox[{"1", "/", "4"}], ")"}]}], "*", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"k", "*", "mu", "*", "sigv"}], ")"}], "^", "2"}]}], "]"}]}], 
    ";"}], " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dd", "=", 
     RowBox[{"Exp", "[", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"(", 
         RowBox[{"1", "/", "4"}], ")"}]}], "*", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"k", "*", "mu", "*", "sigd"}], ")"}], "^", "2"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ddg", "=", 
     RowBox[{"Exp", "[", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"(", 
         RowBox[{"1", "/", "4"}], ")"}]}], "*", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"k", "*", "mu", "*", "sigdg"}], ")"}], "^", "2"}]}], "]"}]}],
     ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.753843325792654*^9, 3.753843335279114*^9}, {
   3.753845038060817*^9, 3.753845062145918*^9}, {3.753845204206905*^9, 
   3.753845242233488*^9}, {3.753845353235606*^9, 3.7538453583201227`*^9}, {
   3.7538456001335087`*^9, 3.7538456003510923`*^9}, {3.7538457311658697`*^9, 
   3.7538458116120663`*^9}, {3.753845921572382*^9, 3.753845927297502*^9}, {
   3.7538498135809927`*^9, 3.753849815170397*^9}, {3.7538545063969173`*^9, 
   3.753854525369205*^9}, {3.753873679188223*^9, 3.75387370009763*^9}, {
   3.75388021063249*^9, 3.753880244248877*^9}, {3.753881415443345*^9, 
   3.753881418655822*^9}, {3.753899765463208*^9, 3.7538997667502527`*^9}, {
   3.753899918912189*^9, 3.753899938847909*^9}, {3.753943234668397*^9, 
   3.753943236272009*^9}, {3.7539439581469707`*^9, 3.7539439660652657`*^9}, {
   3.753944009771865*^9, 3.753944019365555*^9}, {3.7539440602034388`*^9, 
   3.753944064383294*^9}, {3.753945171424295*^9, 3.753945182621099*^9}, {
   3.753945222660337*^9, 3.7539452411822987`*^9}, {3.753961044151523*^9, 
   3.753961066430131*^9}, {3.753961156650991*^9, 3.753961158296878*^9}, {
   3.753961535130705*^9, 3.753961540660392*^9}, {3.754632404154221*^9, 
   3.7546324255984163`*^9}, {3.779788340733317*^9, 3.779788348515234*^9}, {
   3.779788435376313*^9, 3.779788492395069*^9}, 3.779788674900302*^9, {
   3.77978884496231*^9, 3.779788845372233*^9}, {3.779791123521098*^9, 
   3.7797911739919653`*^9}, {3.7797928569748983`*^9, 3.779792861593565*^9}, 
   3.779792977052794*^9, 3.7797948329691057`*^9, {3.7797950136052*^9, 
   3.779795016059111*^9}, {3.7798698881884527`*^9, 3.779869920615316*^9}, {
   3.780469809956367*^9, 3.780469907367136*^9}, {3.780471029514099*^9, 
   3.780471032345999*^9}, {3.78047125229664*^9, 3.780471329615312*^9}, 
   3.7804715467552223`*^9, {3.7804716023686*^9, 3.78047160887702*^9}, 
   3.7804813010405807`*^9, 3.7804814535261297`*^9, {3.78072021037532*^9, 
   3.780720227474556*^9}, {3.7808116875477333`*^9, 3.780811705464982*^9}, {
   3.780929341664805*^9, 3.7809293929956007`*^9}, {3.7809294480314074`*^9, 
   3.780929763613626*^9}, {3.78093831646087*^9, 3.7809383334587517`*^9}, {
   3.781001032669466*^9, 3.7810010613924303`*^9}, {3.781004561108981*^9, 
   3.7810045622595*^9}, {3.781004752678125*^9, 3.781004754444388*^9}, {
   3.781010721627056*^9, 3.781010726753384*^9}, {3.781021613586315*^9, 
   3.781021614143839*^9}, {3.781109153730999*^9, 3.78110915555404*^9}, {
   3.783404251530568*^9, 3.783404294153387*^9}, {3.783406620155864*^9, 
   3.783406623665595*^9}, {3.783408402744322*^9, 3.783408535080093*^9}, 
   3.783490088409371*^9, {3.7859136789899817`*^9, 3.785913680912524*^9}, {
   3.8032722036916428`*^9, 3.8032722239446087`*^9}, {3.803272309277741*^9, 
   3.80327235392793*^9}, {3.80370106635294*^9, 3.803701083370441*^9}, {
   3.80370113529771*^9, 3.8037011358365*^9}, {3.8304888649366703`*^9, 
   3.830488937292021*^9}, {3.830488969944652*^9, 3.8304889973526287`*^9}, {
   3.830489310310165*^9, 3.8304893500723658`*^9}, {3.830489385221092*^9, 
   3.830489482119084*^9}, {3.830489514839473*^9, 3.830489657492227*^9}, {
   3.830489884169909*^9, 3.830489891605891*^9}, {3.830490145795225*^9, 
   3.830490159468668*^9}, 3.830490797089602*^9, 3.830490832805443*^9, 
   3.830492168498415*^9, {3.830514527314178*^9, 3.8305145357373447`*^9}, {
   3.830516249410355*^9, 3.830516276822426*^9}, {3.8305717320884438`*^9, 
   3.830571758859622*^9}, {3.830571841671462*^9, 3.830571864179821*^9}, {
   3.830572132740151*^9, 3.8305721360260487`*^9}, 3.830572425270216*^9, 
   3.8305725716676083`*^9, 3.830572774287126*^9, {3.830576311352352*^9, 
   3.830576325368395*^9}, {3.830576466400476*^9, 3.8305765082113457`*^9}, 
   3.831462477620036*^9, {3.8314625279145947`*^9, 3.831462530562121*^9}, 
   3.831523690530727*^9, {3.831544978072083*^9, 3.831544981650814*^9}, {
   3.83154505723949*^9, 3.8315450650347567`*^9}, {3.831606211613755*^9, 
   3.831606252236619*^9}, {3.8431941859144077`*^9, 3.843194187336801*^9}, {
   3.843194272340045*^9, 3.843194276651956*^9}, {3.843194647561604*^9, 
   3.843194653732545*^9}, {3.8431947583105583`*^9, 3.8431947722547693`*^9}, {
   3.843194833454962*^9, 3.843194867940035*^9}, {3.843194946918694*^9, 
   3.843195002847908*^9}, {3.843195042690875*^9, 3.843195074692807*^9}, {
   3.843195490148568*^9, 3.843195498142956*^9}, 3.843195535529413*^9, {
   3.8431963239950037`*^9, 3.843196329288877*^9}, {3.84319712212081*^9, 
   3.843197125992872*^9}, {3.843197208137371*^9, 3.843197226609934*^9}, {
   3.843391183483138*^9, 3.843391196338017*^9}, {3.843394651481498*^9, 
   3.843394672492378*^9}, 3.843410267142933*^9, {3.843410742648119*^9, 
   3.843410779375978*^9}, {3.844497702770797*^9, 3.844497745152079*^9}, {
   3.8445075016288757`*^9, 3.844507512305606*^9}, {3.8450882338384523`*^9, 
   3.8450882378289747`*^9}, {3.845088517805605*^9, 3.845088550223816*^9}, {
   3.8450887061734753`*^9, 3.845088729601406*^9}, {3.845088760854147*^9, 
   3.8450888133275213`*^9}, {3.845224238716717*^9, 3.84522425241415*^9}, 
   3.84522838634448*^9, {3.845261267741413*^9, 3.845261282459988*^9}, {
   3.845261578543939*^9, 3.845261584269969*^9}, {3.845267226987606*^9, 
   3.845267250341745*^9}, {3.845284745906885*^9, 3.845284746825316*^9}, {
   3.845284783402233*^9, 3.845284814673196*^9}, {3.845284909823655*^9, 
   3.8452849401399803`*^9}, {3.845285014998323*^9, 3.845285023633171*^9}, {
   3.845285132355563*^9, 3.845285178013959*^9}, {3.845285219004499*^9, 
   3.845285248926631*^9}, {3.845391831571542*^9, 3.8453918442563763`*^9}, {
   3.84539220565796*^9, 3.845392207980947*^9}, {3.845392429773885*^9, 
   3.845392432482665*^9}, {3.84539267969786*^9, 3.845392730562788*^9}, {
   3.845392826833488*^9, 3.845392835657865*^9}, {3.845393101860055*^9, 
   3.8453932239489317`*^9}, 3.845393259249572*^9, {3.845551606863083*^9, 
   3.845551610868143*^9}, {3.845551740855898*^9, 3.8455518075896683`*^9}, {
   3.845551864846691*^9, 3.845551887239929*^9}, {3.8455519272244987`*^9, 
   3.8455519368675423`*^9}, {3.84555197015662*^9, 3.845552045017103*^9}, {
   3.846126634131723*^9, 3.846126634926373*^9}, {3.84612686096696*^9, 
   3.846126861194892*^9}, {3.8461271594505053`*^9, 3.846127177168899*^9}, {
   3.84612732819189*^9, 3.846127364211935*^9}, {3.846127469905532*^9, 
   3.846127503166442*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"f76d4d03-db2e-462c-9e13-0a7b9ec76ceb"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.845551719137038*^9, 
  3.8455517215593243`*^9}},ExpressionUUID->"254a69b3-084c-4f09-9be4-\
72e7694fdc2c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"etan", "=", "eta"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "etan", " ", "could", " ", "be", " ", "used", " ", "to", " ", 
    "generalise"}], " ", "*)"}], " ", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rep", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"p", "[", "1", "]"}], "\[Rule]", "p"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"p", "'"}], "[", "1", "]"}], "\[Rule]", 
       RowBox[{"p", "+", 
        RowBox[{"pder", "*", "k", "*", 
         RowBox[{"mu", "^", "2"}]}]}]}]}], "}"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "if", " ", "Y", " ", "is", " ", "also", " ", "in", " ", "the", " ", 
     "noise"}], ",", " ", 
    RowBox[{
     RowBox[{"then", " ", 
      RowBox[{"p", "'"}]}], "\[Rule]", " ", 
     RowBox[{"p", "+", "pder"}]}]}], " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dcp", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Simplify", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{"c", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
           RowBox[{"ppar", "[", 
            RowBox[{"[", "a", "]"}], "]"}]}], "]"}], "/.", 
         RowBox[{"ok", "\[Rule]", "0"}]}], "/.", 
        RowBox[{"eta", "\[Rule]", "1"}]}], "/.", "rep"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "n"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "n"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"a", ",", "npar"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", "c", "]"}], ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gamma", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Simplify", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"invc", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "m"}], "]"}], "]"}], "*", 
           RowBox[{"invc", "[", 
            RowBox[{"[", 
             RowBox[{"j", ",", "l"}], "]"}], "]"}]}], ")"}], "/.", 
         RowBox[{"ok", "\[Rule]", "0"}]}], "/.", 
        RowBox[{"eta", "\[Rule]", "1"}]}], "/.", "rep"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "n"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "n"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"l", ",", "n"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"m", ",", "n"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{"c", ",", "invc"}], "]"}], ";"}], "\n", "\n", 
  RowBox[{"(*", " ", 
   RowBox[{
   "this", " ", "cell", " ", "might", " ", "take", " ", "a", " ", "few", " ", 
    "minutes"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fmu", "[", 
    RowBox[{
    "p_", ",", "beta_", ",", "betag_", ",", "eta_", ",", "k_", ",", "z_", ",",
      "sv2_", ",", "sigd_", ",", "sigv_", ",", "sigdg_", ",", "pder_"}], 
    "]"}], "=", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ppar2", "[", 
             RowBox[{"[", "a", "]"}], "]"}], "*", 
            RowBox[{"ppar2", "[", 
             RowBox[{"[", "b", "]"}], "]"}], "*", 
            RowBox[{"Simplify", "[", 
             RowBox[{
              RowBox[{"dcp", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j", ",", "a"}], "]"}], "]"}], "*", 
              RowBox[{"dcp", "[", 
               RowBox[{"[", 
                RowBox[{"l", ",", "m", ",", "b"}], "]"}], "]"}]}], "]"}], "*", 
            RowBox[{"gamma", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "j", ",", "l", ",", "m"}], "]"}], "]"}]}], "/.", 
           RowBox[{"ok", "\[Rule]", "0"}]}], "/.", 
          RowBox[{"eta", "\[Rule]", "1"}]}], "/.", "rep"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "n"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "n"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"l", ",", "n"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"m", ",", "n"}], "}"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"a", ",", "npar"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"b", ",", "npar"}], "}"}]}], "]"}], "/.", 
    RowBox[{"ok", "\[Rule]", "0"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{"dcp", ",", "gamma"}], "]"}], ";"}], "\n", "\[IndentingNewLine]", 
  
  RowBox[{"(*", " ", 
   RowBox[{"numerical", " ", "Fisher", " ", "Matrix"}], " ", "*)"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fisheraux", "[", 
     RowBox[{
     "p_", ",", "beta_", ",", "betag_", ",", "eta_", ",", "k_", ",", "z_", 
      ",", "sv2_", ",", "sigd_", ",", "sigv_", ",", "sigdg_", ",", "pder_"}], 
     "]"}], ":=", 
    RowBox[{"2", "*", 
     RowBox[{"(", 
      RowBox[{"1", "/", "2"}], ")"}], "*", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"b", ">", "a"}], ",", 
         RowBox[{"NIntegrate", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"fmu", "[", 
             RowBox[{
             "p", ",", "beta", ",", "betag", ",", "eta", ",", "k", ",", "z", 
              ",", "sv2", ",", "sigd", ",", "sigv", ",", "sigdg", ",", 
              "pder"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"a", ",", "b"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"mu", ",", "0", ",", "1"}], "}"}]}], "]"}], ",", "0"}], 
        "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"a", ",", "1", ",", "npar"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"b", ",", "1", ",", "npar"}], "}"}]}], "]"}]}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"exploit", " ", "the", " ", "symmetry"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fisher", "[", 
     RowBox[{
     "p_", ",", "beta_", ",", "betag_", ",", "eta_", ",", "k_", ",", "z_", 
      ",", "sv2_", ",", "sigd_", ",", "sigv_", ",", "sigdg_", ",", "pder_"}], 
     "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", 
      RowBox[{
       RowBox[{"mat", "=", 
        RowBox[{"fisheraux", "[", 
         RowBox[{
         "p", ",", "beta", ",", "betag", ",", "eta", ",", "k", ",", "z", ",", 
          "sv2", ",", "sigd", ",", "sigv", ",", "sigdg", ",", "pder"}], 
         "]"}]}], ";", 
       RowBox[{"fm", "=", 
        RowBox[{"mat", "+", 
         RowBox[{"Transpose", "[", "mat", "]"}], "+", 
         RowBox[{"2", "*", 
          RowBox[{"(", 
           RowBox[{"1", "/", "2"}], ")"}], "*", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"b", "==", "a"}], ",", 
              RowBox[{"NIntegrate", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"fmu", "[", 
                  RowBox[{
                  "p", ",", "beta", ",", "betag", ",", "eta", ",", "k", ",", 
                   "z", ",", "sv2", ",", "sigd", ",", "sigv", ",", "sigdg", 
                   ",", "pder"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"a", ",", "b"}], "]"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"mu", ",", "0", ",", "1"}], "}"}]}], "]"}], ",", 
              "0"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "1", ",", "npar"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"b", ",", "1", ",", "npar"}], "}"}]}], "]"}]}]}]}], ";", 
       "fm"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]",
   "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.7810048727087812`*^9, 3.781004970037208*^9}, {
   3.781010766277141*^9, 3.781010766901884*^9}, {3.7810108013073263`*^9, 
   3.781010844151867*^9}, {3.7810109869215527`*^9, 3.781010989221264*^9}, {
   3.7810119481977654`*^9, 3.78101195027707*^9}, {3.781012924615082*^9, 
   3.7810129253437*^9}, {3.781013150147468*^9, 3.781013153771036*^9}, 
   3.781021693163879*^9, {3.781021739170364*^9, 3.78102174661344*^9}, {
   3.7810221417349586`*^9, 3.781022146640914*^9}, {3.783404316698656*^9, 
   3.7834043421861553`*^9}, 3.7834083933454447`*^9, {3.7834085383678217`*^9, 
   3.783408541352089*^9}, {3.8032656062770157`*^9, 3.803265648376169*^9}, {
   3.803636793173101*^9, 3.803636794032209*^9}, {3.803637163194881*^9, 
   3.803637163503585*^9}, {3.803701091670623*^9, 3.803701092116029*^9}, {
   3.830489935041628*^9, 3.830489955772897*^9}, 3.830490880656293*^9, 
   3.830491385022676*^9, 3.830491899755795*^9, 3.830509305931567*^9, 
   3.831083065942933*^9, {3.83146257846915*^9, 3.83146258409308*^9}, {
   3.831462785896325*^9, 3.831462793188418*^9}, {3.835611362164198*^9, 
   3.835611416188786*^9}, {3.83561156633705*^9, 3.835611571454981*^9}, {
   3.835611684275269*^9, 3.8356117102673492`*^9}, {3.83561174671805*^9, 
   3.83561175020142*^9}, {3.8357537286964607`*^9, 3.835753738178878*^9}, {
   3.843195553636599*^9, 3.843195561087721*^9}, {3.8431965542081537`*^9, 
   3.843196557699991*^9}, {3.843196678283931*^9, 3.8431966851649446`*^9}, {
   3.8431970336202497`*^9, 3.843197034589571*^9}, {3.8439930704462547`*^9, 
   3.843993078224531*^9}, {3.845228337949223*^9, 3.845228363349517*^9}, {
   3.84526198049426*^9, 3.845261984502977*^9}, 3.8453928476507053`*^9, {
   3.846126531344602*^9, 3.8461265356438026`*^9}, {3.8461272038448153`*^9, 
   3.8461272189911633`*^9}, {3.846150908334065*^9, 3.8461509124590187`*^9}},
 CellLabel->"In[17]:=",ExpressionUUID->"023821ad-72af-498e-9660-01b987c0a72f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Fiducials and survey specifics", "Section",
 CellChangeTimes->{{3.780642723643846*^9, 3.780642739018121*^9}, 
   3.783407186654901*^9, 3.783408897703223*^9, {3.783409334896844*^9, 
   3.783409344200748*^9}},ExpressionUUID->"75e975c5-b638-434b-8bef-\
62194f63aea4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Read", " ", "power", " ", "spectrum", " ", "from", " ", "CAMB"}],
     ";", " ", 
    RowBox[{
     RowBox[{"the", " ", "non"}], "-", 
     RowBox[{
     "linear", " ", "correction", " ", "depends", " ", "on", " ", "z", " ", 
      "but", "  ", "the", " ", "difference", " ", "is", " ", 
      "negligible"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"PSzero", "=", 
     RowBox[{"Import", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
        "\"\<camb083.dat\>\""}], ",", "\"\<Table\>\""}], "]"}]}], ";", " ", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"norm", " ", "s8"}], "=", "0.83"}], " ", "*)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"PSfunc", "=", 
     RowBox[{"Interpolation", "[", "PSzero", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ListLogLogPlot", "[", 
     RowBox[{"PSfunc", ",", 
      RowBox[{"Joined", "\[Rule]", " ", "True"}], ",", 
      RowBox[{"PlotRange", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0.001", ",", "0.5"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"700", ",", "30000"}], "}"}]}], "}"}]}], ",", 
      RowBox[{"Frame", "\[Rule]", "True"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "fiducial", " ", "cosmology", " ", "and", " ", "survey", " ", 
     "specifics"}], " ", "*)"}], "\n", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", "om", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"omegam", "=", "0.3"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"grgam", "=", "0.545"}], ";", " ", 
    RowBox[{"(*", " ", 
     RowBox[{"LCDM", " ", "growth", " ", "index"}], " ", "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"Hubble", " ", "function", " ", "fiducial"}], " ", "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"eh2", "[", "z_", "]"}], "=", 
     RowBox[{
      RowBox[{"omegam", "*", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "+", "z"}], ")"}], "^", "3"}]}], "+", "1", "-", 
      "omegam"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", "Omega_matter", " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"om", "[", "z_", "]"}], "=", 
     RowBox[{"omegam", "*", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "+", "z"}], ")"}], "^", "3"}], "/", 
       RowBox[{"eh2", "[", "z", "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"growth", " ", "rate"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"fgrow", "[", 
      RowBox[{"z_", ",", "grgam_"}], "]"}], "=", 
     RowBox[{
      RowBox[{"om", "[", "z", "]"}], "^", "grgam"}]}], ";"}], "\n", 
   RowBox[{"(*", " ", 
    RowBox[{"growth", " ", "factor"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gr", "=", 
     RowBox[{"Interpolation", "[", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"z", ",", 
          RowBox[{"Exp", "[", 
           RowBox[{"-", 
            RowBox[{"NIntegrate", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"fgrow", "[", 
                RowBox[{"zx", ",", "grgam"}], "]"}], "/", 
               RowBox[{"(", 
                RowBox[{"1", "+", "zx"}], ")"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"zx", ",", "0", ",", "z"}], "}"}], ",", 
              RowBox[{"WorkingPrecision", "\[Rule]", "10"}], ",", 
              RowBox[{"MaxRecursion", "\[Rule]", "12"}]}], "]"}]}], "]"}]}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"z", ",", "0", ",", "1", ",", "0.01"}], "}"}]}], "]"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"evolved", " ", "spectrum", " ", "at", " ", "z"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"pskz", "[", 
      RowBox[{"k_", ",", "z_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"PSfunc", "[", "k", "]"}], "*", 
      RowBox[{
       RowBox[{"gr", "[", "z", "]"}], "^", "2"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"pskzder", "[", 
      RowBox[{"k_", ",", "z_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"D", "[", 
        RowBox[{
         RowBox[{"PSfunc", "[", "kx", "]"}], ",", "kx"}], "]"}], "*", 
       RowBox[{
        RowBox[{"gr", "[", "z", "]"}], "^", "2"}]}], "/.", 
      RowBox[{"kx", "\[Rule]", "k"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"SNe", " ", "and", " ", "galaxy", " ", "survey", " ", "data"}], 
    " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", "\n", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"case", "=", "2"}], ";", " ", 
    RowBox[{"(*", " ", "Conservative", " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"ndens", "=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0.011", ",", "0.032", ",", "0.054", ",", "0.051"}], "}"}], 
      "*", 
      RowBox[{"10", "^", 
       RowBox[{"(", 
        RowBox[{"-", "3"}], ")"}]}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vol", "=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0.019", ",", "0.123", ",", "0.303", ",", "0.531"}], "}"}], 
      "*", 
      RowBox[{"10", "^", "9"}]}]}], ";"}], " ", "\[IndentingNewLine]", " ", 
   RowBox[{
    RowBox[{"zbins", "=", 
     RowBox[{"{", 
      RowBox[{"0.05", ",", "0.15", ",", "0.25", ",", "0.35"}], "}"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"kmin", "=", 
     RowBox[{"{", 
      RowBox[{"0.0175", ",", "0.0094", ",", "0.007", ",", "0.0058"}], "}"}]}],
     ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"kmax", "=", 
     RowBox[{"{", 
      RowBox[{"0.1", ",", "0.1", ",", "0.1", ",", "0.1"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"case", "=", "1"}], ";", " ", 
    RowBox[{"(*", " ", "Aggressive", " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"ndens", "=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "0.096", ",", "0.105", ",", "0.114", ",", "0.122", ",", "0.131", ",", 
        "0.139", ",", "0.148"}], "}"}], "*", 
      RowBox[{"10", "^", 
       RowBox[{"(", 
        RowBox[{"-", "3"}], ")"}]}]}]}], ";"}], " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vol", "=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "0.0459", ",", "0.296", ",", "0.727", ",", "1.27", ",", "1.88", ",", 
        "2.51", ",", "3.13"}], "}"}], "*", 
      RowBox[{"10", "^", "9"}]}]}], ";"}], " ", "\[IndentingNewLine]", " ", 
   RowBox[{
    RowBox[{"zbins", "=", 
     RowBox[{"{", 
      RowBox[{
      "0.05", ",", "0.15", ",", "0.25", ",", "0.35", ",", "0.45", ",", "0.55",
        ",", "0.65"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"kmin", "=", 
     RowBox[{"{", 
      RowBox[{
      "0.0175", ",", "0.0094", ",", "0.007", ",", "0.0058", ",", "0.0051", 
       ",", "0.0046", ",", "0.0043"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"kmax", "=", 
     RowBox[{"{", 
      RowBox[{
      "0.1", ",", "0.1", ",", "0.11", ",", "0.11", ",", "0.12", ",", "0.13", 
       ",", "0.13"}], "}"}]}], ";", " ", 
    RowBox[{"(*", " ", 
     RowBox[{"increasing", " ", "with", " ", "z"}], " ", "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"kmax", "=", 
     RowBox[{"{", 
      RowBox[{
      "0.1", ",", "0.1", ",", "0.1", ",", "0.1", ",", "0.1", ",", "0.1", ",", 
       "0.1"}], "}"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"galaxy", " ", "data"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"r", "=", "10"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ndensg", "=", 
     RowBox[{"r", "*", "ndens"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"k", "-", 
     RowBox[{"cell", " ", 
      RowBox[{"gamma", "^", "2"}], " ", "factor"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"gam2", "[", 
      RowBox[{"k_", ",", "V_"}], "]"}], "=", 
     RowBox[{"2", "*", 
      RowBox[{
       RowBox[{"Pi", "/", 
        RowBox[{"k", "^", "2"}]}], "/", 
       RowBox[{"V", "^", 
        RowBox[{"(", 
         RowBox[{"2", "/", "3"}], ")"}]}]}]}]}], ";"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"etax", "[", "z_", "]"}], ":=", "1"}], ";", " ", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"fiducial", " ", "for", " ", 
       RowBox[{"HD", "/", "H_r"}], " ", "D_r"}], ";", " ", 
      RowBox[{"already", " ", "inserted"}]}], " ", "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"hfidx", "[", "z_", "]"}], "=", 
     RowBox[{
      RowBox[{"Sqrt", "[", 
       RowBox[{"eh2", "[", "z", "]"}], "]"}], "/", "2997."}]}], ";", "  ", 
    RowBox[{"(*", " ", 
     RowBox[{"fiducial", " ", "H_r"}], " ", "*)"}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
     "fiducial", " ", "luminosity", " ", "distance", " ", "and", " ", 
      "derivative"}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"rint", "=", 
     RowBox[{"Interpolation", "[", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"z", ",", 
          RowBox[{"NIntegrate", "[", 
           RowBox[{
            RowBox[{"1", "/", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"eh2", "[", "zint", "]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"zint", ",", "0", ",", "z"}], "}"}]}], "]"}]}], "}"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"z", ",", "0", ",", "1", ",", "0.01"}], "}"}]}], "]"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dlum", "[", "z_", "]"}], ":=", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "+", "z"}], ")"}], "*", 
      RowBox[{"rint", "[", "z", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"dlump", "[", "z_", "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "+", "z"}], ")"}], "/", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"eh2", "[", "z", "]"}], "]"}]}], "+", 
      RowBox[{"rint", "[", "z", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"velocity", " ", "shot", " ", "noise"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sigint", "=", "0.13"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"signonlin", "=", "300"}], ";"}], " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"svx", "[", "zx_", "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Log", "[", "10", "]"}], "/", "5"}], "*", 
         RowBox[{
          RowBox[{"dlum", "[", "zx", "]"}], "/", 
          RowBox[{"dlump", "[", "zx", "]"}]}], "*", 
         RowBox[{"sigint", "/", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"2", "*", 
             RowBox[{
              RowBox[{"dlum", "[", "zx", "]"}], "/", 
              RowBox[{"dlump", "[", "zx", "]"}]}]}], "-", "1", "-", "zx"}], 
           ")"}]}]}], ")"}], "^", "2"}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"signonlin", "/", "300000"}], ")"}], "^", "2"}]}]}], ";"}], 
   " ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"fiducial", " ", "bias"}], "=", "1"}], "  ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"bias", "[", "z_", "]"}], "=", 
     RowBox[{"1.", "/", 
      RowBox[{"gr", "[", "z", "]"}]}]}], ";", "  ", 
    RowBox[{"(*", " ", 
     RowBox[{"SN", " ", "bias"}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"biasg", "[", "z_", "]"}], "=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"z", "<=", "0.3"}], ",", 
       RowBox[{"1.34", "/", 
        RowBox[{"gr", "[", "z", "]"}]}], ",", 
       RowBox[{"1.7", "/", 
        RowBox[{"gr", "[", "z", "]"}]}]}], "]"}]}], ";", " ", 
    RowBox[{"(*", " ", 
     RowBox[{"galaxy", " ", "bias"}], " ", "*)"}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"fiducial", " ", "SN", " ", "beta"}], "=", 
      RowBox[{"f", "/", "bias"}]}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"b1fid", "[", "z_", "]"}], "=", 
     RowBox[{
      RowBox[{"fgrow", "[", 
       RowBox[{"z", ",", "grgam"}], "]"}], "/", 
      RowBox[{"bias", "[", "z", "]"}]}]}], ";"}], "  ", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"fiducial", " ", "galaxy", " ", "beta"}], "=", 
     RowBox[{"f", "/", "bias_g"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"b1gfid", "[", "z_", "]"}], "=", 
     RowBox[{
      RowBox[{"fgrow", "[", 
       RowBox[{"z", ",", "grgam"}], "]"}], "/", 
      RowBox[{"biasg", "[", "z", "]"}]}]}], ";"}], "  ", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "fiducial", " ", "smoothing", " ", "velocity", " ", "in", " ", "Mpc"}], 
     ";", " ", 
     RowBox[{"values", " ", "from", " ", "Howlett", " ", "2017"}]}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sigmagfid", "=", "4.24"}], ";"}], " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sigmasfid", "=", "4.24"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sigmavfid", "=", "8.5"}], ";"}], " ", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "fiducial", " ", "smoothing", " ", "velocity", " ", "in", " ", "Mpc"}], 
     ";", " ", 
     RowBox[{"values", " ", "from", " ", "Howlett", " ", "2017"}]}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sigdx", "=", "sigmasfid"}], ";"}], " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sigvx", "=", "sigmavfid"}], ";"}], " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sigdgx", "=", "sigmagfid"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sigdx0", "=", "sigmasfid"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sigvx0", "=", "sigmavfid"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"fraction", " ", "of", " ", "SN", " ", "in", " ", "galaxies"}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"frac", "=", "0"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.748857571877277*^9, 3.748857593211495*^9}, {
   3.748861718099424*^9, 3.748861718282608*^9}, {3.74920530592309*^9, 
   3.74920536063498*^9}, {3.7493638450039597`*^9, 3.749363860333014*^9}, {
   3.749813700871622*^9, 3.749813707311069*^9}, 3.7505937614077997`*^9, 
   3.7505964575543137`*^9, 3.75059649183185*^9, {3.751002103447233*^9, 
   3.751002103876656*^9}, {3.751002917878097*^9, 3.751002919827982*^9}, 
   3.754375553712811*^9, {3.7545504630403023`*^9, 3.754550479532576*^9}, {
   3.759301015121491*^9, 3.759301036858776*^9}, 3.7812488801730423`*^9, {
   3.782378741201479*^9, 3.782378813378221*^9}, {3.7823794154250727`*^9, 
   3.782379454537252*^9}, {3.7834043976349487`*^9, 3.7834044683696136`*^9}, {
   3.783405301389839*^9, 3.783405362269202*^9}, {3.783408362422722*^9, 
   3.7834083761741247`*^9}, {3.7834093748899317`*^9, 3.783409375489224*^9}, 
   3.783409416074298*^9, {3.7834895316858873`*^9, 3.7834895339082403`*^9}, 
   3.783489566450459*^9, {3.8166732007201557`*^9, 3.816673300090412*^9}, 
   3.831787540024394*^9, {3.83575382444381*^9, 3.835753825036036*^9}, 
   3.8433955074847937`*^9, {3.8433958073544407`*^9, 3.843395848854056*^9}, {
   3.843888962294251*^9, 3.843888994642395*^9}, {3.843969370162303*^9, 
   3.8439693763851347`*^9}, {3.843969452486134*^9, 3.843969465277582*^9}, {
   3.8444978202879066`*^9, 3.8444978550449123`*^9}, 3.844507587252137*^9, {
   3.84471318505525*^9, 3.844713194113881*^9}, {3.845088932839622*^9, 
   3.845088934534974*^9}, {3.84539202418664*^9, 3.845392056486288*^9}, 
   3.84539308590219*^9, {3.845552096020299*^9, 3.845552115291462*^9}, {
   3.845552199408574*^9, 3.845552201857835*^9}, {3.846126652837802*^9, 
   3.8461266644964657`*^9}, {3.8461272336951647`*^9, 3.846127237621591*^9}, {
   3.846237242394203*^9, 
   3.846237243982574*^9}},ExpressionUUID->"4661df84-4198-4470-9b1d-\
0f4782cc8ebb"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7834057930920067`*^9, 3.78340582687748*^9}, 
   3.783405941609487*^9},ExpressionUUID->"ecf8efd0-e67f-4661-a25c-\
80c548e28fcf"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Error on H: general routine ", "Section",
 CellChangeTimes->{{3.781627522379773*^9, 3.781627529255928*^9}, {
   3.78340460116261*^9, 3.783404605257757*^9}, {3.783409211656345*^9, 
   3.7834092279442873`*^9}, {3.830507174812929*^9, 3.830507182868093*^9}, {
   3.830534912662222*^9, 3.8305349305450983`*^9}, {3.8305861209121513`*^9, 
   3.8305861231524487`*^9}, {3.8305893292796173`*^9, 3.830589330234782*^9}, {
   3.83062260200805*^9, 3.830622602889975*^9}, 3.831083117416956*^9, {
   3.831547210819365*^9, 3.831547213220153*^9}, {3.831612663759451*^9, 
   3.831612668731544*^9}, {3.831652287049281*^9, 3.8316522875350323`*^9}, {
   3.831787362901203*^9, 3.83178736416291*^9}, {3.842673181884489*^9, 
   3.842673182981361*^9}, {3.8433945343060217`*^9, 3.843394534782444*^9}, {
   3.843964250996785*^9, 3.843964253393836*^9}, {3.8439645481440363`*^9, 
   3.843964556541616*^9}},ExpressionUUID->"127807ea-7579-4282-9e40-\
398d9b060b62"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
  "reproduces", " ", "the", " ", "last", " ", "column", " ", "in", " ", 
   "Table", " ", "4", " ", "of", " ", 
   RowBox[{"arXiv", ":", "2111.05185"}]}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.844497949199271*^9, 3.8444979662160788`*^9}, 
   3.845909828293643*^9},ExpressionUUID->"eec07079-2ff7-4286-9e2f-\
90c412b44f77"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"\"\<Case: \>\"", ",", "case"}], "]"}], ";", 
  RowBox[{"Clear", "[", "nb", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sigdx", "=", "sigdx0"}], ";", 
   RowBox[{"sigvx", "=", "sigvx0"}], ";", 
   RowBox[{"sigdgx", "=", "sigdx0"}], ";", 
   RowBox[{"ndensg", "=", 
    RowBox[{"r", "*", "ndens"}]}], ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"totalerrh", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"Length", "[", "vol", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"totalerrhfix", "=", "totalerrh"}], ";"}], 
  " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"totalerrhprior", "=", "totalerrh"}], ";"}], " ", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fullmatkz", "=", "totalerrh"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"nbins", "=", 
    RowBox[{"Length", "[", "zbins", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "position", " ", "of", " ", "eta", " ", "from", " ", "end", " ", "in", " ",
     "ppar"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"poseta", "=", 
   RowBox[{"-", 
    RowBox[{"(", 
     RowBox[{"npar", "-", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{"ppar", ",", "eta"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}], "+", "1"}], ")"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"results", "=", 
    RowBox[{"{", "}"}]}], ";"}], "\n", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"results", "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"omegapriorerror", "=", "0.0001"}], ";", " ", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"when", " ", "very", " ", "small"}], ",", " ", 
    RowBox[{
     RowBox[{"this", "  ", "gives", " ", "the", " ", "Omega_k"}], "=", 
     RowBox[{"0", " ", "results"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"priorerror", "=", "0.5"}], ";", " ", 
  RowBox[{"(*", " ", 
   RowBox[{"prior", " ", "on", " ", "the", " ", "three", " ", 
    RowBox[{"sigma", "'"}], "s"}], " ", "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"fullfm", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"0", ",", 
     RowBox[{"{", 
      RowBox[{"zshell", ",", " ", "nbins"}], "}"}]}], "]"}]}], ";", 
  RowBox[{"nbv", "=", "fullfm"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ndens0", "=", "ndens"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "prepare", " ", "the", " ", "partial", " ", "FM", " ", "for", " ", "every",
     " ", "z"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"do", " ", "over", " ", "z", " ", "shells"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"Do", "[", 
  RowBox[{
   RowBox[{"{", "   ", 
    RowBox[{"(*", " ", 
     RowBox[{"do", " ", "over", " ", "external", " ", "parameters"}], " ", 
     "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"sigdx", "=", 
      RowBox[{"sigdx0", "*", "facsmooth"}]}], ";", 
     RowBox[{"r", "=", 
      RowBox[{"10", "^", "lr"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ndens", "=", 
      RowBox[{
       RowBox[{"10", "^", "ln"}], "*", "ndens0"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ndensg", "=", 
      RowBox[{"r", "*", "ndens"}]}], ";", " ", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "use", " ", "this", " ", "if", " ", "you", " ", "want", " ", "to", " ",
         "express", " ", "the", " ", "SN", " ", "bias", " ", "as", " ", "a", 
        " ", "constant", " ", "fraction", " ", "of", " ", "the", " ", 
        "galaxy", " ", "bias"}], "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"bias", "[", "z_", "]"}], "=", 
        RowBox[{
         RowBox[{"biasg", "[", "z", "]"}], "*", "facbias"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
        "sn", " ", "bias", " ", "equal", " ", "facbias", " ", "the", " ", 
         "galaxy", " ", "bias"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"b1fid", "[", "z_", "]"}], "=", 
        RowBox[{
         RowBox[{"fgrow", "[", 
          RowBox[{"z", ",", "grgam"}], "]"}], "/", 
         RowBox[{"bias", "[", "z", "]"}]}]}], ";"}], " ", 
      "\[IndentingNewLine]", "*)"}], " ", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"{", "   ", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"Do", " ", "over", " ", "z"}], "-", "bins"}], " ", "*)"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"set", " ", "up", " ", "the", " ", "k"}], "-", "binning"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"dek", "=", 
          RowBox[{"2", "*", 
           RowBox[{"Pi", "/", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"vol", "[", 
               RowBox[{"[", "zshell", "]"}], "]"}], ")"}], "^", 
             RowBox[{"(", 
              RowBox[{"1", "/", "3"}], ")"}]}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"kbins", "=", 
          RowBox[{"Range", "[", 
           RowBox[{
            RowBox[{"kmax", "[", 
             RowBox[{"[", "zshell", "]"}], "]"}], ",", 
            RowBox[{"kmin", "[", 
             RowBox[{"[", "zshell", "]"}], "]"}], ",", 
            RowBox[{"-", "dek"}]}], "]"}]}], ";", 
         RowBox[{"kbins", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"kbins", ",", 
            RowBox[{"{", 
             RowBox[{"kmin", "[", 
              RowBox[{"[", "zshell", "]"}], "]"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"deklast", "=", 
          RowBox[{
           RowBox[{"kbins", "[", 
            RowBox[{"[", 
             RowBox[{"-", "2"}], "]"}], "]"}], "-", 
           RowBox[{"kmin", "[", 
            RowBox[{"[", "zshell", "]"}], "]"}]}]}], ";", " ", 
         RowBox[{"(*", " ", 
          RowBox[{
          "the", " ", "last", " ", "kbin", " ", "is", " ", "smaller", " ", 
           "in", " ", "order", " ", "not", " ", "to", " ", "go", " ", "below",
            " ", "kmin"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"kvec", "=", 
          RowBox[{"MovingAverage", "[", 
           RowBox[{"kbins", ",", "2"}], "]"}]}], ";", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"central", " ", "ks"}], " ", "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"nbv", "[", 
           RowBox[{"[", "zshell", "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"Length", "[", "kbins", "]"}], "-", "1"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"nb", "=", 
          RowBox[{"nbv", "[", 
           RowBox[{"[", "zshell", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"kbins", "=", "kvec"}], ";", " ", 
         RowBox[{"(*", " ", 
          RowBox[{
          "correction", " ", "to", " ", "enforce", " ", "the", " ", "use", 
           " ", "of", " ", "kvec", " ", "in", " ", "what", " ", "follows"}], 
          " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"i", "=", "0"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"nb", "=", 
          RowBox[{"nbv", "[", 
           RowBox[{"[", "zshell", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"Print", "[", 
          RowBox[{"\"\<z= \>\"", ",", 
           RowBox[{"zbins", "[", 
            RowBox[{"[", "zshell", "]"}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"hfid", "=", 
          RowBox[{"hfidx", "[", 
           RowBox[{"zbins", "[", 
            RowBox[{"[", "zshell", "]"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"nz", "=", 
          RowBox[{"nzorig", "+", "n0orig"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"fullmatk", "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", 
             RowBox[{"im", ",", 
              RowBox[{
               RowBox[{"nb", "*", "nk"}], "+", "nz"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"jm", ",", 
              RowBox[{
               RowBox[{"nb", "*", "nk"}], "+", "nz"}]}], "}"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "   ", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{"Do", " ", "over", " ", "k"}], "-", "bins"}], " ", "*)"}],
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"matk", "=", 
              RowBox[{
               RowBox[{"1", "/", 
                RowBox[{"gam2", "[", 
                 RowBox[{
                  RowBox[{"kbins", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", 
                  RowBox[{"vol", "[", 
                   RowBox[{"[", "zshell", "]"}], "]"}]}], "]"}]}], "*", 
               RowBox[{"fisher", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"bias", "[", 
                    RowBox[{"zbins", "[", 
                    RowBox[{"[", "zshell", "]"}], "]"}], "]"}], "^", "2"}], 
                  "*", 
                  RowBox[{"ndens", "[", 
                   RowBox[{"[", "zshell", "]"}], "]"}], "*", 
                  RowBox[{"pskz", "[", 
                   RowBox[{
                    RowBox[{"kbins", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"zbins", "[", 
                    RowBox[{"[", "zshell", "]"}], "]"}]}], "]"}]}], ",", 
                 RowBox[{"b1fid", "[", 
                  RowBox[{"zbins", "[", 
                   RowBox[{"[", "zshell", "]"}], "]"}], "]"}], ",", 
                 RowBox[{"b1gfid", "[", 
                  RowBox[{"zbins", "[", 
                   RowBox[{"[", "zshell", "]"}], "]"}], "]"}], ",", 
                 RowBox[{"etax", "[", 
                  RowBox[{"zbins", "[", 
                   RowBox[{"[", "zshell", "]"}], "]"}], "]"}], ",", 
                 RowBox[{"kbins", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", 
                 RowBox[{"zbins", "[", 
                  RowBox[{"[", "zshell", "]"}], "]"}], ",", 
                 RowBox[{"svx", "[", 
                  RowBox[{"zbins", "[", 
                   RowBox[{"[", "zshell", "]"}], "]"}], "]"}], ",", "sigdx", 
                 ",", "sigvx", ",", "sigdgx", ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"bias", "[", 
                    RowBox[{"zbins", "[", 
                    RowBox[{"[", "zshell", "]"}], "]"}], "]"}], "^", "2"}], 
                  "*", 
                  RowBox[{"ndens", "[", 
                   RowBox[{"[", "zshell", "]"}], "]"}], "*", 
                  RowBox[{"pskzder", "[", 
                   RowBox[{
                    RowBox[{"kbins", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"zbins", "[", 
                    RowBox[{"[", "zshell", "]"}], "]"}]}], "]"}]}]}], 
                "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"fullmatk", "=", 
              RowBox[{"fullmatk", "+", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"im", "\[GreaterEqual]", 
                    RowBox[{
                    RowBox[{"nk", "*", 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}], "+", "1"}]}], " ", "&&",
                     " ", 
                    RowBox[{"im", "\[LessEqual]", 
                    RowBox[{
                    RowBox[{"nk", "*", 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}], "+", "nk"}]}]}], ")"}], 
                    " ", "&&", "  ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"jm", "\[GreaterEqual]", 
                    RowBox[{
                    RowBox[{"nk", "*", 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}], "+", "1"}]}], " ", "&&",
                     " ", 
                    RowBox[{"jm", "\[LessEqual]", 
                    RowBox[{
                    RowBox[{"nk", "*", 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}], "+", "nk"}]}]}], 
                    ")"}]}], ")"}], "  ", "\[IndentingNewLine]", ",", 
                   RowBox[{"matk", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"im", "-", 
                    RowBox[{"nk", "*", 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}]}], ",", 
                    RowBox[{"jm", "-", 
                    RowBox[{"nk", "*", 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}]}]}], "]"}], "]"}], ",", 
                   "0"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"im", ",", 
                   RowBox[{
                    RowBox[{"nb", "*", "nk"}], "+", "nz"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"jm", ",", 
                   RowBox[{
                    RowBox[{"nb", "*", "nk"}], "+", "nz"}]}], "}"}]}], "]"}], 
               "+", "\[IndentingNewLine]", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"If", "[", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"im", "\[GreaterEqual]", 
                    RowBox[{
                    RowBox[{"nk", "*", 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}], "+", "1"}]}], " ", "&&",
                     " ", 
                    RowBox[{"im", "\[LessEqual]", 
                    RowBox[{
                    RowBox[{"nk", "*", 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}], "+", "nk"}]}]}], ")"}], 
                    " ", "&&", "  ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"jm", "\[GreaterEqual]", 
                    RowBox[{
                    RowBox[{"nk", "*", "nb"}], "+", "1"}]}], " ", "&&", " ", 
                    RowBox[{"jm", "<=", 
                    RowBox[{
                    RowBox[{"nk", "*", "nb"}], "+", "nz"}]}]}], " ", ")"}]}], 
                    ")"}], " ", "\[IndentingNewLine]", ",", 
                   RowBox[{"matk", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"im", "-", 
                    RowBox[{"nk", "*", 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}]}], ",", 
                    RowBox[{"jm", "-", 
                    RowBox[{"nk", "*", 
                    RowBox[{"(", 
                    RowBox[{"nb", "-", "1"}], ")"}]}]}]}], "]"}], "]"}], ",", 
                   "0"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"im", ",", 
                   RowBox[{
                    RowBox[{"nb", "*", "nk"}], "+", "nz"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"jm", ",", 
                   RowBox[{
                    RowBox[{"nb", "*", "nk"}], "+", "nz"}]}], "}"}]}], "]"}], 
               "+", "\[IndentingNewLine]", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"If", "[", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"jm", "\[GreaterEqual]", 
                    RowBox[{
                    RowBox[{"nk", "*", 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}], "+", "1"}]}], " ", "&&",
                     " ", 
                    RowBox[{"jm", "\[LessEqual]", 
                    RowBox[{
                    RowBox[{"nk", "*", 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}], "+", "nk"}]}]}], ")"}], 
                    " ", "&&", "  ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"im", "\[GreaterEqual]", 
                    RowBox[{
                    RowBox[{"nk", "*", "nb"}], "+", "1"}]}], " ", "&&", " ", 
                    RowBox[{"im", "<=", 
                    RowBox[{
                    RowBox[{"nk", "*", "nb"}], "+", "nz"}]}]}], " ", ")"}]}], 
                    ")"}], " ", "\[IndentingNewLine]", ",", 
                   RowBox[{"matk", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"im", "-", 
                    RowBox[{"nk", "*", 
                    RowBox[{"(", 
                    RowBox[{"nb", "-", "1"}], ")"}]}]}], ",", 
                    RowBox[{"jm", "-", 
                    RowBox[{"nk", "*", 
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}]}]}]}], "]"}], "]"}], ",", 
                   "0"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"im", ",", 
                   RowBox[{
                    RowBox[{"nb", "*", "nk"}], "+", "nz"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"jm", ",", 
                   RowBox[{
                    RowBox[{"nb", "*", "nk"}], "+", "nz"}]}], "}"}]}], "]"}], 
               "+", "\[IndentingNewLine]", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"If", "[", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"im", "\[GreaterEqual]", 
                    RowBox[{
                    RowBox[{"nk", "*", "nb"}], "+", "1"}]}], " ", "&&", " ", 
                    RowBox[{"im", "<=", 
                    RowBox[{
                    RowBox[{"nk", "*", "nb"}], "+", "nz"}]}]}], " ", ")"}], 
                    " ", "&&", "  ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"jm", "\[GreaterEqual]", 
                    RowBox[{
                    RowBox[{"nk", "*", "nb"}], "+", "1"}]}], " ", "&&", " ", 
                    RowBox[{"jm", "<=", 
                    RowBox[{
                    RowBox[{"nk", "*", "nb"}], "+", "nz"}]}]}], " ", ")"}]}], 
                    ")"}], " ", "\[IndentingNewLine]", ",", 
                   RowBox[{"matk", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"im", "-", 
                    RowBox[{"nk", "*", 
                    RowBox[{"(", 
                    RowBox[{"nb", "-", "1"}], ")"}]}]}], ",", 
                    RowBox[{"jm", "-", 
                    RowBox[{"nk", "*", 
                    RowBox[{"(", 
                    RowBox[{"nb", "-", "1"}], ")"}]}]}]}], "]"}], "]"}], ",", 
                   "0"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"im", ",", 
                   RowBox[{
                    RowBox[{"nb", "*", "nk"}], "+", "nz"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"jm", ",", 
                   RowBox[{
                    RowBox[{"nb", "*", "nk"}], "+", "nz"}]}], "}"}]}], 
                "]"}]}]}], ";"}], "\[IndentingNewLine]", 
            "\[IndentingNewLine]", "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "nb"}], "}"}]}], "]"}], ";", 
         RowBox[{
          RowBox[{"fullfm", "[", 
           RowBox[{"[", "zshell", "]"}], "]"}], "=", "fullmatk"}], ";"}], 
        "\[IndentingNewLine]", "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"zshell", ",", 
         RowBox[{"Length", "[", "zbins", "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n0", "=", "n0orig"}], ";", "\[IndentingNewLine]", 
     RowBox[{"nz", "=", "nzorig"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", "omegapriorerror", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"dimfm", "=", 
      RowBox[{
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"nbv", "[", 
           RowBox[{"[", "ibins", "]"}], "]"}], "*", "nk"}], ",", 
         RowBox[{"{", 
          RowBox[{"ibins", ",", "nbins"}], "}"}]}], "]"}], "+", 
       RowBox[{"nbins", "*", "nz"}], "+", "n0"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fullmatk", "=", 
      RowBox[{"Table", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"im", ",", "dimfm"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"jm", ",", "dimfm"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fullmatz", "=", "fullmatk"}], ";", "\[IndentingNewLine]", 
     RowBox[{"oksector", "=", "fullmatk"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ksector", "=", "fullmatk"}], ";", 
     RowBox[{"zsector", "=", 
      RowBox[{"Table", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "nbins"}], "}"}]}], "]"}]}], ";", 
     RowBox[{"oksector", "=", "zsector"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"assemble", " ", "the", " ", "z"}], "-", 
       RowBox[{
       "bin", " ", "FM", " ", "into", " ", "a", " ", "single", " ", "FM"}]}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"{", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"do", " ", "over", " ", "z", " ", "bins"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", " ", 
          RowBox[{"(*", " ", 
           RowBox[{"do", " ", "over", " ", "k", " ", "bins"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"ii", "=", "1"}], ";", 
             RowBox[{"iit", "=", "1"}], ";", "\[IndentingNewLine]", 
             RowBox[{"zshell", "=", "j"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"matk", "=", 
              RowBox[{"fullfm", "[", 
               RowBox[{"[", "zshell", "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"dimfm", "=", 
              RowBox[{
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"nbv", "[", 
                   RowBox[{"[", "ibins", "]"}], "]"}], "*", "nk"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"ibins", ",", "nbins"}], "}"}]}], "]"}], "+", 
               RowBox[{"nbins", "*", "nz"}], "+", "n0"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"dimmatk", "=", 
              RowBox[{
               RowBox[{
                RowBox[{"nbv", "[", 
                 RowBox[{"[", "zshell", "]"}], "]"}], "*", "nk"}], "+", "nz", 
               "+", "n0"}]}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"a", "=", 
              RowBox[{
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"nbv", "[", 
                   RowBox[{"[", "ibins", "]"}], "]"}], "*", "nk"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"ibins", ",", "nbins"}], "}"}]}], "]"}], "+", 
               RowBox[{"nbins", "*", "nz"}]}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"b", "=", 
              RowBox[{
               RowBox[{
                RowBox[{"nbv", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], "*", "nk"}], "+", "nz"}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"c", "=", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"j", "\[Equal]", "1"}], ",", "0", ",", 
                RowBox[{
                 RowBox[{"Sum", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"nbv", "[", 
                    RowBox[{"[", "ibins", "]"}], "]"}], "*", "nk"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"ibins", ",", 
                    RowBox[{"j", "-", "1"}]}], "}"}]}], "]"}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"j", "-", "1"}], ")"}], "*", "nz"}]}]}], "]"}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"ksector", "=", 
              RowBox[{"ksector", "+", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"im", "\[GreaterEqual]", " ", 
                    RowBox[{"c", "+", "1", " ", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}], "*", "nk"}]}]}], " ", "&&",
                     " ", 
                    RowBox[{"im", "  ", "\[LessEqual]", 
                    RowBox[{"c", "+", "nk", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}], "*", "nk"}]}]}]}], ")"}], 
                    "  ", "&&", "  ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"jm", "\[GreaterEqual]", " ", 
                    RowBox[{"c", "+", "1", " ", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}], "*", "nk"}]}]}], " ", "&&",
                     " ", 
                    RowBox[{"jm", "\[LessEqual]", "  ", 
                    RowBox[{"c", "+", "nk", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "-", "1"}], ")"}], "*", "nk"}]}]}]}], "  ", 
                    ")"}]}], ")"}], "\[IndentingNewLine]", ",", 
                   RowBox[{"matk", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"im", "-", "c"}], ",", 
                    RowBox[{"jm", "-", "c"}]}], "]"}], "]"}], ",", "0"}], 
                  "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"im", ",", "dimfm"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"jm", ",", "dimfm"}], "}"}]}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"zsector", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "=", "\[IndentingNewLine]", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"im", "\[GreaterEqual]", " ", 
                    RowBox[{"c", "+", "1", " ", "+", 
                    RowBox[{"nk", "*", 
                    RowBox[{"nbv", "[", 
                    RowBox[{"[", "j", "]"}], "]"}]}]}]}], "  ", "||", "  ", 
                    RowBox[{"jm", "\[GreaterEqual]", " ", 
                    RowBox[{"c", "+", "1", " ", "+", 
                    RowBox[{"nk", "*", 
                    RowBox[{"nbv", "[", 
                    RowBox[{"[", "j", "]"}], "]"}]}]}]}]}], ")"}], "  ", 
                   "\[IndentingNewLine]", "&&", " ", 
                   RowBox[{"(", 
                    RowBox[{"im", " ", "\[LessEqual]", "  ", 
                    RowBox[{"c", "+", "nz", " ", "+", 
                    RowBox[{"nk", "*", 
                    RowBox[{"nbv", "[", 
                    RowBox[{"[", "j", "]"}], "]"}]}]}]}], ")"}], " ", "&&", 
                   "  ", 
                   RowBox[{"(", 
                    RowBox[{"jm", " ", "\[LessEqual]", "  ", 
                    RowBox[{"c", "+", "nz", " ", "+", 
                    RowBox[{"nk", "*", 
                    RowBox[{"nbv", "[", 
                    RowBox[{"[", "j", "]"}], "]"}]}]}]}], ")"}], 
                   "\[IndentingNewLine]", "&&", " ", 
                   RowBox[{"(", 
                    RowBox[{"im", " ", "\[GreaterEqual]", 
                    RowBox[{"c", "+", "1"}]}], " ", ")"}], " ", "&&", "  ", 
                   RowBox[{"(", 
                    RowBox[{"jm", " ", "\[GreaterEqual]", 
                    RowBox[{"c", "+", "1"}]}], " ", ")"}]}], 
                  "\[IndentingNewLine]", ",", 
                  RowBox[{"matk", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"im", "-", "c"}], ",", 
                    RowBox[{"jm", "-", "c"}]}], "]"}], "]"}], ",", "0"}], 
                 "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"im", ",", "dimfm"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"jm", ",", "dimfm"}], "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"oksector", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "=", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"If", "[", " ", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"im", "\[GreaterEqual]", " ", 
                    RowBox[{"a", " ", "+", "1"}]}], " ", "&&", " ", 
                    RowBox[{"im", "\[LessEqual]", " ", 
                    RowBox[{"a", "+", "n0"}]}], " ", "&&", " ", 
                    RowBox[{"jm", "\[GreaterEqual]", " ", 
                    RowBox[{"a", "+", "1"}]}], " ", "&&", " ", 
                    RowBox[{"jm", "\[LessEqual]", " ", 
                    RowBox[{"a", "+", "n0"}]}]}], ")"}], 
                   "\[IndentingNewLine]", ",", 
                   RowBox[{"matk", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"im", "-", "a", "+", "b"}], ",", 
                    RowBox[{"jm", "-", "a", "+", "b"}]}], "]"}], "]"}], ",", 
                   "0"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"im", ",", "dimfm"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"jm", ",", "dimfm"}], "}"}]}], "]"}], 
               "\[IndentingNewLine]", " ", "+", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"im", "\[GreaterEqual]", " ", 
                    RowBox[{"a", "+", "1"}]}], "    ", "&&", "  ", 
                    RowBox[{"im", "\[LessEqual]", "   ", 
                    RowBox[{"a", "+", "n0"}]}], "  ", "&&", " ", 
                    RowBox[{"jm", "\[GreaterEqual]", " ", 
                    RowBox[{"c", " ", "+", "1"}]}], "  ", "&&", "  ", 
                    RowBox[{"jm", "\[LessEqual]", "   ", 
                    RowBox[{"c", "+", "b"}]}]}], "    ", ")"}], " ", 
                   "\[IndentingNewLine]", ",", 
                   RowBox[{"matk", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"im", "-", "a", "+", "b"}], ",", 
                    RowBox[{"jm", "-", "c"}]}], "]"}], "]"}], ",", "0"}], 
                  "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"im", ",", "dimfm"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"jm", ",", "dimfm"}], "}"}]}], "]"}], " ", 
               "\[IndentingNewLine]", "+", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"jm", "\[GreaterEqual]", " ", 
                    RowBox[{"a", "+", "1"}]}], "    ", "&&", "  ", 
                    RowBox[{"jm", "\[LessEqual]", "   ", 
                    RowBox[{"a", "+", "n0"}]}], "  ", "&&", " ", 
                    RowBox[{"im", "\[GreaterEqual]", " ", 
                    RowBox[{"c", "+", "1"}]}], "   ", "&&", "  ", 
                    RowBox[{"im", "\[LessEqual]", "   ", 
                    RowBox[{"c", "+", "b"}]}]}], "    ", ")"}], " ", 
                   "\[IndentingNewLine]", ",", 
                   RowBox[{"matk", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"im", "-", "c"}], ",", 
                    RowBox[{"jm", "-", "a", "+", "b"}]}], "]"}], "]"}], ",", 
                   "0"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"im", ",", "dimfm"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"jm", ",", "dimfm"}], "}"}]}], "]"}]}]}], ";"}], 
            " ", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{"im", " ", "rows"}], ";", " ", 
              RowBox[{"jm", "=", "cols"}]}], " ", "*)"}], 
            "\[IndentingNewLine]", "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"nbv", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
         RowBox[{"fullmatz", "=", "ksector"}], ";"}], " ", 
        "\[IndentingNewLine]", " ", "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "nbins"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "adding", " ", "priors", " ", "for", " ", "n0", " ", "paramaters"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"omegaprior", "[", "omegapriorerror_", "]"}], "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"i", "\[Equal]", "j"}], " ", "&&", " ", 
           RowBox[{
           "dimfm", "\[GreaterEqual]", " ", "i", "\[GreaterEqual]", " ", 
            "dimfm"}], " ", "&&", " ", 
           RowBox[{
           "dimfm", "\[GreaterEqual]", " ", "j", "\[GreaterEqual]", "  ", 
            "dimfm"}]}], ",", 
          RowBox[{"1", "/", 
           RowBox[{"omegapriorerror", "^", "2"}]}], ",", "0"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "dimfm"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "dimfm"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sigmaprior", "[", "priorerror_", "]"}], "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"i", "\[Equal]", "j"}], " ", "&&", " ", 
           RowBox[{"dimfm", ">", "i", ">", 
            RowBox[{"dimfm", "-", "n0"}]}], "  ", "&&", " ", 
           RowBox[{"dimfm", ">", "j", ">", 
            RowBox[{"dimfm", "-", "n0"}]}]}], " ", ",", 
          RowBox[{"1", "/", 
           RowBox[{"priorerror", "^", "2"}]}], ",", "0"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "dimfm"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "dimfm"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"fullmatz", "=", 
      RowBox[{"fullmatz", "+", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{"zsector", "[", 
          RowBox[{"[", "j", "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "nbins"}], "}"}]}], "]"}], "+", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{"oksector", "[", 
          RowBox[{"[", "j", "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "nbins"}], "}"}]}], "]"}], "+", 
       RowBox[{"omegaprior", "[", "omegapriorerror", "]"}], "+", 
       RowBox[{"sigmaprior", "[", "priorerror", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sumfm", "=", 
      RowBox[{"Inverse", "[", "fullmatz", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"totalerrhprior", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Sqrt", "[", 
         RowBox[{"sumfm", "[", 
          RowBox[{"[", "  ", 
           RowBox[{
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"nbv", "[", 
                 RowBox[{"[", "ix", "]"}], "]"}], "*", "nk"}], ",", 
               RowBox[{"{", 
                RowBox[{"ix", ",", "i"}], "}"}]}], "]"}], "+", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"i", "-", "1"}], ")"}], "*", "nz"}], "+", "1"}], ",", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"nbv", "[", 
                 RowBox[{"[", "ix", "]"}], "]"}], "*", "nk"}], ",", 
               RowBox[{"{", 
                RowBox[{"ix", ",", "i"}], "}"}]}], "]"}], "+", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"i", "-", "1"}], ")"}], "*", "nz"}], "+", "1"}]}], " ",
            "]"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "nbins"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"totalerrokprior", "=", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"sumfm", "[", 
        RowBox[{"[", "  ", 
         RowBox[{"dimfm", ",", "dimfm"}], " ", "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"results", "=", 
      RowBox[{"Append", "[", 
       RowBox[{"results", ",", "totalerrhprior"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"\"\<\[CapitalDelta]H/H: \>\"", ",", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"zbins", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", 
            RowBox[{"results", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "i"}], "]"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "nbins"}], "}"}]}], "]"}], "//", "TableForm"}]}],
       "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{"facsmooth", ",", 
     RowBox[{"{", "1", "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"lr", ",", 
     RowBox[{"{", "1", "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"ln", ",", 
     RowBox[{"{", "0", "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"frac", ",", 
     RowBox[{"{", "0", "}"}]}], "}"}]}], 
  "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.780643948730912*^9, 3.780643967966811*^9}, 
   3.780650924232226*^9, {3.780934585584702*^9, 3.780934652407526*^9}, {
   3.78093504667494*^9, 3.780935072304916*^9}, {3.780936527652417*^9, 
   3.7809365288079042`*^9}, {3.7809385922531557`*^9, 3.780938600046218*^9}, {
   3.78093935634429*^9, 3.780939393350445*^9}, {3.780939526120669*^9, 
   3.780939528273405*^9}, {3.780939614767503*^9, 3.78093965011709*^9}, {
   3.781011541790329*^9, 3.781011542627643*^9}, {3.78101168763412*^9, 
   3.781011690198153*^9}, {3.7810117907218924`*^9, 3.781011813616239*^9}, 
   3.781011855461116*^9, {3.781012063883212*^9, 3.781012064910771*^9}, {
   3.781022530305791*^9, 3.781022540749349*^9}, {3.783404771527853*^9, 
   3.783404776533618*^9}, {3.783406781014637*^9, 3.783406781387413*^9}, {
   3.783407493689753*^9, 3.783407499582415*^9}, {3.783407557393396*^9, 
   3.783407564622057*^9}, 3.783407622746707*^9, {3.783407693576991*^9, 
   3.783407704958744*^9}, {3.783407980795369*^9, 3.783408037704379*^9}, {
   3.783408911405384*^9, 3.783408951339429*^9}, {3.783409546424005*^9, 
   3.7834095514829187`*^9}, {3.783410815106182*^9, 3.783410844478158*^9}, {
   3.783411960933544*^9, 3.7834119916530333`*^9}, 3.7834122808947783`*^9, {
   3.783489464579831*^9, 3.7834895095392237`*^9}, {3.7852269687550907`*^9, 
   3.785226992792934*^9}, {3.800879501698586*^9, 3.80087950215836*^9}, {
   3.800987542359346*^9, 3.800987628686315*^9}, {3.801026550441691*^9, 
   3.8010265566480827`*^9}, {3.801119660139415*^9, 3.801119698816313*^9}, {
   3.8032722833358307`*^9, 3.803272287019822*^9}, {3.8037019913128147`*^9, 
   3.803702089862054*^9}, {3.803702196097671*^9, 3.803702213044189*^9}, {
   3.80370256807852*^9, 3.803702571109709*^9}, {3.803873794429473*^9, 
   3.803873806435624*^9}, {3.803927445829568*^9, 3.8039274575022993`*^9}, {
   3.8039275018304167`*^9, 3.803927505844367*^9}, {3.803927583520796*^9, 
   3.803927585945139*^9}, 3.8039280515511246`*^9, {3.8039280842137604`*^9, 
   3.8039281104027405`*^9}, {3.8039293629469075`*^9, 
   3.8039293936757193`*^9}, {3.803929430241918*^9, 3.8039294328828273`*^9}, {
   3.8043115789941273`*^9, 3.804311584838799*^9}, {3.830504038410204*^9, 
   3.8305040411236677`*^9}, {3.830504073502975*^9, 3.830504109600184*^9}, {
   3.830504246690156*^9, 3.8305042903769608`*^9}, 3.830504820268368*^9, {
   3.8305048612297697`*^9, 3.830504871453866*^9}, {3.830504916930311*^9, 
   3.830504937811056*^9}, {3.830504969926162*^9, 3.830505025001088*^9}, {
   3.830507241998088*^9, 3.8305072521188717`*^9}, {3.830507345247078*^9, 
   3.830507372340597*^9}, {3.830516748428008*^9, 3.830516769497929*^9}, {
   3.830517217922223*^9, 3.830517221851904*^9}, {3.8305177773193417`*^9, 
   3.830517849213998*^9}, {3.8305178812298203`*^9, 3.830517918570732*^9}, {
   3.830519145365757*^9, 3.830519149687722*^9}, {3.830524623913855*^9, 
   3.830524678046996*^9}, {3.830527996611602*^9, 3.830527997145631*^9}, {
   3.8305349729121447`*^9, 3.830535151421028*^9}, {3.830535203727202*^9, 
   3.830535219876918*^9}, {3.830537056011796*^9, 3.8305370808086977`*^9}, {
   3.830537141166185*^9, 3.830537146514337*^9}, {3.830568565977137*^9, 
   3.830568568502553*^9}, {3.830569654292067*^9, 3.830569656886425*^9}, {
   3.830570143785932*^9, 3.8305701647043457`*^9}, {3.830570753250718*^9, 
   3.830570777366259*^9}, {3.830574238557173*^9, 3.8305742387969503`*^9}, {
   3.830574683404975*^9, 3.830574685446691*^9}, {3.8305863575211487`*^9, 
   3.830586398914208*^9}, {3.830589287258452*^9, 3.830589294049741*^9}, {
   3.830589348890139*^9, 3.830589421525206*^9}, {3.830589461626912*^9, 
   3.830589506357267*^9}, {3.830589550693616*^9, 3.830589629115086*^9}, {
   3.830622617116226*^9, 3.830622708613398*^9}, {3.830622748906938*^9, 
   3.83062275017618*^9}, {3.831083161186906*^9, 3.831083225485601*^9}, {
   3.8310832975116587`*^9, 3.8310833311532497`*^9}, 3.8311033693801403`*^9, {
   3.83152375955926*^9, 3.831523759818857*^9}, 3.831523795472581*^9, {
   3.831523945354618*^9, 3.831523950100841*^9}, {3.8315733163535967`*^9, 
   3.8315733213919773`*^9}, 3.831787458984029*^9, {3.835753959610512*^9, 
   3.835753959914215*^9}, 3.841030263441236*^9, {3.841030542555304*^9, 
   3.8410305480441217`*^9}, {3.841030896024632*^9, 3.841030899312052*^9}, {
   3.842623934119573*^9, 3.8426240090873747`*^9}, {3.843205034764818*^9, 
   3.843205054052951*^9}, {3.843205221295826*^9, 3.843205284731641*^9}, {
   3.8432053175660963`*^9, 3.84320534073215*^9}, {3.8432054755321503`*^9, 
   3.8432054774017467`*^9}, {3.843205508769452*^9, 3.8432055135360622`*^9}, 
   3.843205702758534*^9, {3.843205743679281*^9, 3.843205759565187*^9}, {
   3.843205794937914*^9, 3.843205808458666*^9}, {3.843214460680414*^9, 
   3.8432144888240137`*^9}, {3.8432167875412693`*^9, 
   3.8432167968398647`*^9}, {3.843216835161017*^9, 3.843216870908299*^9}, {
   3.843216912010573*^9, 3.843216987495633*^9}, {3.843217088046403*^9, 
   3.843217089250813*^9}, {3.8432242476342382`*^9, 3.843224353261634*^9}, {
   3.843224393864259*^9, 3.8432243966440077`*^9}, {3.843224508290599*^9, 
   3.843224511737322*^9}, {3.843224559197197*^9, 3.8432245696363487`*^9}, {
   3.843304662631262*^9, 3.84330469227923*^9}, {3.843304774558589*^9, 
   3.84330479646876*^9}, {3.843304930502561*^9, 3.843304993742586*^9}, {
   3.8433051016832952`*^9, 3.8433051264513206`*^9}, 3.843305178795912*^9, {
   3.843305456980784*^9, 3.843305539834806*^9}, {3.843305572348731*^9, 
   3.843305664018599*^9}, {3.843305913970249*^9, 3.843305933061861*^9}, {
   3.843306036678129*^9, 3.843306073124613*^9}, 3.843306145078424*^9, {
   3.843306183619658*^9, 3.8433062685377274`*^9}, {3.843306381977324*^9, 
   3.8433064562497263`*^9}, {3.84330650325358*^9, 3.843306521731395*^9}, {
   3.843306562821301*^9, 3.843306696483727*^9}, {3.8433111001125793`*^9, 
   3.843311188338797*^9}, 3.8433955661293716`*^9, {3.8433957170847883`*^9, 
   3.843395719828223*^9}, {3.8433957932823887`*^9, 3.843395793664337*^9}, 
   3.843397705960265*^9, {3.8434010862898693`*^9, 3.843401089464363*^9}, {
   3.843449990432053*^9, 3.843449993023754*^9}, {3.8438890653134117`*^9, 
   3.843889066414702*^9}, {3.8439838174308643`*^9, 3.843983822388788*^9}, {
   3.844004009214645*^9, 3.844004014193969*^9}, 3.844497976568377*^9, {
   3.844507620941804*^9, 3.844507722193712*^9}, {3.8445077682346363`*^9, 
   3.8445078017071*^9}, 3.8445078764861917`*^9, {3.844508020417968*^9, 
   3.844508046559801*^9}, {3.844508083933857*^9, 3.8445081199409933`*^9}, 
   3.844511246871361*^9, {3.844514842630505*^9, 3.844514871016498*^9}, {
   3.844515242058415*^9, 3.844515249900972*^9}, {3.8445153034778433`*^9, 
   3.844515322485149*^9}, 3.8445199747421303`*^9, {3.844520355342821*^9, 
   3.8445203645416727`*^9}, {3.844520407564843*^9, 3.844520425758967*^9}, {
   3.844670043219714*^9, 3.8446701239461327`*^9}, {3.844670368925789*^9, 
   3.8446703761204042`*^9}, {3.8446777847061872`*^9, 3.844677826039525*^9}, {
   3.844677937234326*^9, 3.844677946915183*^9}, {3.8447132172102413`*^9, 
   3.8447132198361273`*^9}, 3.845088949486706*^9, {3.845215556666153*^9, 
   3.8452155595330753`*^9}, {3.845284988498206*^9, 3.845284991850954*^9}, {
   3.845552153318194*^9, 3.845552155702443*^9}, {3.8460716615238867`*^9, 
   3.846071667779018*^9}, {3.846127250311645*^9, 3.846127316264331*^9}},
 CellLabel->"In[66]:=",ExpressionUUID->"66db22f8-e81e-4549-a287-c617a0b4b88c"],

Cell[BoxData["\[IndentingNewLine]"], "Input",
 CellChangeTimes->{
  3.84521554414544*^9},ExpressionUUID->"047a1c8f-95d6-4280-a710-40438264616c"],

Cell[BoxData["\[IndentingNewLine]"], "Input",
 CellChangeTimes->{
  3.843962362665537*^9},ExpressionUUID->"4a5c03e0-54db-49cc-a6b3-\
01ad71b86391"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1000, 646},
WindowMargins->{{212, Automatic}, {Automatic, 79}},
WindowStatusArea->None,
PrintingCopies->1,
PrintingPageRange->{1, Automatic},
FrontEndVersion->"11.3 for Mac OS X x86 (32-bit, 64-bit Kernel) (March 5, \
2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[422, 15, 816, 15, 222, "Title",ExpressionUUID->"be7de5ef-fc06-4fed-8496-03868675c388"],
Cell[1241, 32, 1269, 23, 173, "Text",ExpressionUUID->"0bdb1a45-2ab7-43bc-8bb3-c6bf88f83168"],
Cell[2513, 57, 360, 8, 52, "Input",ExpressionUUID->"d33f6e9f-b116-40e7-af4d-d13a39b394ee"],
Cell[CellGroupData[{
Cell[2898, 69, 642, 9, 67, "Section",ExpressionUUID->"e7b35478-e180-4bd6-ae4e-7e4bfe44083c"],
Cell[3543, 80, 22885, 501, 2047, "Input",ExpressionUUID->"f76d4d03-db2e-462c-9e13-0a7b9ec76ceb"],
Cell[26431, 583, 154, 3, 30, "Input",ExpressionUUID->"254a69b3-084c-4f09-9be4-72e7694fdc2c"],
Cell[26588, 588, 9980, 257, 724, "Input",ExpressionUUID->"023821ad-72af-498e-9660-01b987c0a72f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[36605, 850, 270, 4, 67, "Section",ExpressionUUID->"75e975c5-b638-434b-8bef-62194f63aea4"],
Cell[36878, 856, 17291, 442, 2383, "Input",ExpressionUUID->"4661df84-4198-4470-9b1d-0f4782cc8ebb"],
Cell[54172, 1300, 176, 3, 30, "Input",ExpressionUUID->"ecf8efd0-e67f-4661-a25c-80c548e28fcf"]
}, Open  ]],
Cell[CellGroupData[{
Cell[54385, 1308, 939, 13, 67, "Section",ExpressionUUID->"127807ea-7579-4282-9e40-398d9b060b62"],
Cell[55327, 1323, 374, 8, 30, "Input",ExpressionUUID->"eec07079-2ff7-4286-9e2f-90c412b44f77"],
Cell[55704, 1333, 47388, 1058, 3328, "Input",ExpressionUUID->"66db22f8-e81e-4549-a287-c617a0b4b88c"],
Cell[103095, 2393, 144, 2, 52, "Input",ExpressionUUID->"047a1c8f-95d6-4280-a710-40438264616c"],
Cell[103242, 2397, 147, 3, 52, "Input",ExpressionUUID->"4a5c03e0-54db-49cc-a6b3-01ad71b86391"]
}, Open  ]]
}, Open  ]]
}
]
*)

